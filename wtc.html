<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTC Simulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f4f8;
            color: #333;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }
        tr:last-child td {
            border-bottom: none;
        }
        #seriesInputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        #seriesInputs div {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        input[type="number"] {
            width: 50px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 0 5px;
        }
        button {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #27ae60;
        }
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>WTC Simulator</h1>
    
    <h2>Initial Standings</h2>
    <table id="initialStandings">
        <!-- Table will be populated by JavaScript -->
    </table>

    <h2>Enter Series Results</h2>
    <div id="seriesInputs">
        <!-- Input fields will be generated by JavaScript -->
    </div>

    <button onclick="runSimulation()">Run Simulation</button>

    <h2>Final Standings</h2>
    <table id="finalStandings">
        <!-- Table will be populated by JavaScript -->
    </table>

    <script>
        class Team {
            constructor(name, currentPoints, winPercentage) {
                this.name = name;
                this.currentPoints = currentPoints;
                this.winPercentage = winPercentage;
                this.totalPoints = (this.currentPoints / this.winPercentage) * 100;
            }

            win() {
                this.currentPoints += 12;
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            draw() {
                this.currentPoints += 4;
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            lose() {
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            updateWinPercentage() {
                this.winPercentage = (this.currentPoints / this.totalPoints) * 100;
            }
        }

        const initialTeams = [
            new Team("IND", 98, 68.06),
            new Team("AUS", 90, 62.50),
            new Team("SL", 60, 55.56),
            new Team("NZ", 48, 44.44),
            new Team("ENG", 93, 43.06),
            new Team("SA", 28, 38.89),
            new Team("BAN", 33, 34.38),
            new Team("PAK", 28, 25.93),
            new Team("WI", 20, 18.52)
        ];

        const series = [
            "IND vs NZ",
            "BAN vs SA",
            "AUS vs IND",
            "WI vs BAN",
            "SA vs SL",
            "NZ vs ENG",
            "SA vs PAK",
            "PAK vs WI"
        ];

        function populateInitialStandings() {
            const table = document.getElementById('initialStandings');
            table.innerHTML = `
                <tr>
                    <th>Team</th>
                    <th>Points</th>
                    <th>Win %</th>
                </tr>
                ${initialTeams.map(team => `
                    <tr>
                        <td>${team.name}</td>
                        <td>${team.currentPoints}</td>
                        <td>${team.winPercentage.toFixed(2)}</td>
                    </tr>
                `).join('')}
            `;
        }

        function generateSeriesInputs() {
            const container = document.getElementById('seriesInputs');
            const initialPossibilities = {
                "IND vs NZ": [2, 0, 0],
                "BAN vs SA": [0, 0, 2],
                "AUS vs IND": [2, 0, 3],
                "WI vs BAN": [1, 0, 1],
                "SA vs SL": [1, 0, 1],
                "NZ vs ENG": [1, 0, 2],
                "SA vs PAK": [1, 0, 1],
                "PAK vs WI": [1, 0, 1]
            };
            
            series.forEach(s => {
                const [team1Wins, draws, team2Wins] = initialPossibilities[s] || [0, 0, 0];
                const maxValue = team1Wins + draws + team2Wins;
                container.innerHTML += `
                    <div>
                        <label>${s}:</label>
                        <input type="number" id="${s}-team1" min="0" max="${maxValue}" value="${team1Wins}" onchange="validateSeriesInputs('${s}', ${maxValue})">
                        <input type="number" id="${s}-draw" min="0" max="${maxValue}" value="${draws}" onchange="validateSeriesInputs('${s}', ${maxValue})">
                        <input type="number" id="${s}-team2" min="0" max="${maxValue}" value="${team2Wins}" onchange="validateSeriesInputs('${s}', ${maxValue})">
                        <div id="${s}-error" class="error"></div>
                    </div>
                `;
            });
        }

        function validateSeriesInputs(seriesId, maxValue) {
            const team1Input = document.getElementById(`${seriesId}-team1`);
            const drawInput = document.getElementById(`${seriesId}-draw`);
            const team2Input = document.getElementById(`${seriesId}-team2`);
            const errorDiv = document.getElementById(`${seriesId}-error`);

            const team1Value = parseInt(team1Input.value) || 0;
            const drawValue = parseInt(drawInput.value) || 0;
            const team2Value = parseInt(team2Input.value) || 0;

            const sum = team1Value + drawValue + team2Value;

            if (sum !== maxValue) {
                errorDiv.textContent = `Total must be ${maxValue}. Current total: ${sum}`;
                return false;
            } else {
                errorDiv.textContent = '';
                return true;
            }
        }

        function runSimulation() {
            const teams = initialTeams.map(t => new Team(t.name, t.currentPoints, t.winPercentage));
            const results = {};
            let isValid = true;

            series.forEach(s => {
                const team1Wins = parseInt(document.getElementById(`${s}-team1`).value);
                const draws = parseInt(document.getElementById(`${s}-draw`).value);
                const team2Wins = parseInt(document.getElementById(`${s}-team2`).value);
                results[s] = [team1Wins, draws, team2Wins];

                const maxValue = team1Wins + draws + team2Wins;
                if (!validateSeriesInputs(s, maxValue)) {
                    isValid = false;
                }
            });

            if (!isValid) {
                alert("Please correct the errors before running the simulation.");
                return;
            }

            simulateSeries(teams, results);
            displayFinalStandings(teams);
        }

        function simulateSeries(teams, results) {
            for (const [seriesName, result] of Object.entries(results)) {
                const [team1Name, team2Name] = seriesName.split(' vs ');
                const [team1Wins, draws, team2Wins] = result;
                
                const team1 = teams.find(t => t.name === team1Name);
                const team2 = teams.find(t => t.name === team2Name);

                for (let i = 0; i < team1Wins; i++) team1.win();
                for (let i = 0; i < team2Wins; i++) team2.win();
                for (let i = 0; i < draws; i++) {
                    team1.draw();
                    team2.draw();
                }
                for (let i = 0; i < team2Wins; i++) team1.lose();
                for (let i = 0; i < team1Wins; i++) team2.lose();
            }
        }

        function displayFinalStandings(teams) {
            teams.sort((a, b) => b.winPercentage - a.winPercentage);
            const table = document.getElementById('finalStandings');
            table.innerHTML = `
                <tr>
                    <th>Team</th>
                    <th>Points</th>
                    <th>Win %</th>
                </tr>
                ${teams.map(team => `
                    <tr>
                        <td>${team.name}</td>
                        <td>${team.currentPoints}</td>
                        <td>${team.winPercentage.toFixed(2)}</td>
                    </tr>
                `).join('')}
            `;
        }

        // Initialize the page
        populateInitialStandings();
        generateSeriesInputs();
    </script>
</body>
</html>