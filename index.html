<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTC 2025 Simulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f4f8;
            color: #333;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }
        tr:last-child td {
            border-bottom: none;
        }
        #seriesInputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }
        .series-input {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        .series-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #3498db;
        }
        .input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .input-group label {
            flex: 1;
            margin-right: 10px;
        }
        .number-input {
            display: flex;
            align-items: center;
        }
        .number-input button {
            width: 30px;
            height: 30px;
            padding: 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
        }
        .number-input input[type="number"] {
            width: 40px;
            text-align: center;
            -moz-appearance: textfield;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .number-input input[type="number"]::-webkit-outer-spin-button,
        .number-input input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        button {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        button:active {
            transform: translateY(1px);
            box-shadow: 0 3px 6px rgba(50, 50, 93, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .collapsible .series-title {
            cursor: pointer;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }

        .collapsible .series-title:hover {
            background-color: #e1e1e1;
        }

        .collapsible .series-content {
            display: none;
            padding: 10px;
        }

        .collapsible.active .series-content {
            display: block;
        }
    </style>
</head>
<body>
    <h1>WTC 2025 Simulator</h1>
    
    <h2>Current Standings 25 Oct 2024</h2>
    <table id="initialStandings">
        <!-- Table will be populated by JavaScript -->
    </table>

    <h2>Click to predict results for upcoming matches!</h2>
    <div id="seriesInputs">
        <!-- Input fields will be generated by JavaScript -->
    </div>

    <button onclick="runSimulation()">Run Simulation</button>

    <h2>Final Standings</h2>
    <table id="finalStandings">
        <!-- Table will be populated by JavaScript -->
    </table>

    <script>
        class Team {
            constructor(name, currentPoints, winPercentage) {
                this.name = name;
                this.currentPoints = currentPoints;
                this.winPercentage = winPercentage;
                this.totalPoints = (this.currentPoints / this.winPercentage) * 100;
            }

            win() {
                this.currentPoints += 12;
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            draw() {
                this.currentPoints += 4;
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            lose() {
                this.totalPoints += 12;
                this.updateWinPercentage();
            }

            updateWinPercentage() {
                this.winPercentage = (this.currentPoints / this.totalPoints) * 100;
            }
        }

        const initialTeams = [
            new Team("IND", 98, 62.82),
            new Team("AUS", 90, 62.50),
            new Team("SL", 60, 55.56),
            new Team("SA", 52, 54.17),
            new Team("NZ", 60, 50.00),
            new Team("ENG", 93, 40.79),
            new Team("PAK", 28, 33.33),
            new Team("BAN", 33, 30.56),
            new Team("WI", 20, 18.52)
        ];

        const series = [
            "IND vs NZ",
            "AUS vs IND",
            "SA vs SL",
            "NZ vs ENG",
            "SA vs PAK",
            "PAK vs WI",
            "SL vs AUS",
            "WI vs BAN",
        ];

        function populateInitialStandings() {
            const table = document.getElementById('initialStandings');
            table.innerHTML = `
                <tr>
                    <th>Team</th>
                    <th>Points</th>
                    <th>Win %</th>
                </tr>
                ${initialTeams.map(team => `
                    <tr>
                        <td>${team.name}</td>
                        <td>${team.currentPoints}</td>
                        <td>${team.winPercentage.toFixed(2)}</td>
                    </tr>
                `).join('')}
            `;
        }

        // Global object to store max matches per series
        const seriesMaxValues = {};

        function generateSeriesInputs() {
            const container = document.getElementById('seriesInputs');
            const initialPossibilities = {
                "IND vs NZ": [1, 0, 0],
                "AUS vs IND": [2, 0, 3],
                "SA vs SL": [1, 0, 1],
                "NZ vs ENG": [1, 0, 2],
                "SA vs PAK": [1, 0, 1],
                "PAK vs WI": [1, 0, 1],
                "SL vs AUS": [0, 0, 2],
                "WI vs BAN": [1, 0, 1]
            };

            container.innerHTML = '';  // Clear existing content
            
            for (const [seriesName, [team1Wins, draws, team2Wins]] of Object.entries(initialPossibilities)) {
                const [team1, team2] = seriesName.split(' vs ');
                const maxValue = team1Wins + draws + team2Wins;

                // Store maxValue in global object
                seriesMaxValues[seriesName] = maxValue;

                // Generate a unique and valid ID
                const seriesId = 'series-' + seriesName.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9\-]/g, '');

                const seriesDiv = document.createElement('div');
                seriesDiv.className = 'series-input collapsible';
                seriesDiv.id = seriesId;
                seriesDiv.innerHTML = `
                    <div class="series-title" onclick="toggleCollapsible(this)">${seriesName} (${maxValue} matches left)</div>
                    <div class="series-content">
                        <div class="input-group">
                            <label>${team1} wins:</label>
                            <div class="number-input">
                                <button class="decrement" onclick="changeValue('${seriesId}-team1', -1, ${maxValue})">-</button>
                                <input type="number" id="${seriesId}-team1" min="0" max="${maxValue}" value="${team1Wins}" onchange="validateSeriesInputs('${seriesId}', ${maxValue})">
                                <button class="increment" onclick="changeValue('${seriesId}-team1', 1, ${maxValue})">+</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Draws:</label>
                            <div class="number-input">
                                <button class="decrement" onclick="changeValue('${seriesId}-draw', -1, ${maxValue})">-</button>
                                <input type="number" id="${seriesId}-draw" min="0" max="${maxValue}" value="${draws}" onchange="validateSeriesInputs('${seriesId}', ${maxValue})">
                                <button class="increment" onclick="changeValue('${seriesId}-draw', 1, ${maxValue})">+</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>${team2} wins:</label>
                            <div class="number-input">
                                <button class="decrement" onclick="changeValue('${seriesId}-team2', -1, ${maxValue})">-</button>
                                <input type="number" id="${seriesId}-team2" min="0" max="${maxValue}" value="${team2Wins}" onchange="validateSeriesInputs('${seriesId}', ${maxValue})">
                                <button class="increment" onclick="changeValue('${seriesId}-team2', 1, ${maxValue})">+</button>
                            </div>
                        </div>
                        <div id="${seriesId}-error" class="error"></div>
                    </div>
                `;
                container.appendChild(seriesDiv);
            }
        }

        function changeValue(inputId, change, maxValue) {
            const input = document.getElementById(inputId);
            let newValue = parseInt(input.value) + change;
            newValue = Math.max(0, Math.min(newValue, maxValue));
            input.value = newValue;
            const seriesId = inputId.split('-').slice(0, -1).join('-');
            const seriesName = seriesId.replace('series-', '').replace(/-/g, ' ');
            validateSeriesInputs(seriesId, maxValue);
        }

        function validateSeriesInputs(seriesId, maxValue) {
            const team1Input = document.getElementById(`${seriesId}-team1`);
            const drawInput = document.getElementById(`${seriesId}-draw`);
            const team2Input = document.getElementById(`${seriesId}-team2`);
            const errorDiv = document.getElementById(`${seriesId}-error`);

            const team1Value = parseInt(team1Input.value) || 0;
            const drawValue = parseInt(drawInput.value) || 0;
            const team2Value = parseInt(team2Input.value) || 0;

            const sum = team1Value + drawValue + team2Value;

            if (sum !== maxValue) {
                errorDiv.textContent = `All possibilities must add up to ${maxValue}, because only ${maxValue} matches are left. Current total: ${sum}`;
                return false;
            } else {
                errorDiv.textContent = '';
                return true;
            }
        }

        function runSimulation() {
            const teams = initialTeams.map(t => new Team(t.name, t.currentPoints, t.winPercentage));
            const results = {};
            let isValid = true;

            series.forEach(s => {
                const seriesId = 'series-' + s.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9\-]/g, '');
                const team1Wins = parseInt(document.getElementById(`${seriesId}-team1`).value) || 0;
                const draws = parseInt(document.getElementById(`${seriesId}-draw`).value) || 0;
                const team2Wins = parseInt(document.getElementById(`${seriesId}-team2`).value) || 0;
                results[s] = [team1Wins, draws, team2Wins];

                const maxValue = seriesMaxValues[s];
                if (!validateSeriesInputs(seriesId, maxValue)) {
                    isValid = false;
                }
            });

            if (!isValid) {
                alert("Please correct the errors before running the simulation.");
                return;
            }

            simulateSeries(teams, results);
            displayFinalStandings(teams);
        }

        function simulateSeries(teams, results) {
            for (const [seriesName, result] of Object.entries(results)) {
                const [team1Name, team2Name] = seriesName.split(' vs ');
                const [team1Wins, draws, team2Wins] = result;
                
                const team1 = teams.find(t => t.name === team1Name);
                const team2 = teams.find(t => t.name === team2Name);

                for (let i = 0; i < team1Wins; i++) team1.win();
                for (let i = 0; i < team2Wins; i++) team2.win();
                for (let i = 0; i < draws; i++) {
                    team1.draw();
                    team2.draw();
                }
                for (let i = 0; i < team2Wins; i++) team1.lose();
                for (let i = 0; i < team1Wins; i++) team2.lose();
            }
        }

        function displayFinalStandings(teams) {
            teams.sort((a, b) => b.winPercentage - a.winPercentage);
            const table = document.getElementById('finalStandings');
            table.innerHTML = `
                <tr>
                    <th>Team</th>
                    <th>Points</th>
                    <th>Win %</th>
                </tr>
                ${teams.map(team => `
                    <tr>
                        <td>${team.name}</td>
                        <td>${team.currentPoints}</td>
                        <td>${team.winPercentage.toFixed(2)}</td>
                    </tr>
                `).join('')}
            `;
        }

        function toggleCollapsible(element) {
            const parent = element.parentElement;
            const wasActive = parent.classList.contains("active");

            // Close all open collapsibles
            document.querySelectorAll('.series-input.active').forEach(el => {
                el.classList.remove("active");
            }); 

            // Toggle the clicked collapsible
            if (!wasActive) {
                parent.classList.add("active");
            }
        }

        // Initialize the page
        populateInitialStandings();
        generateSeriesInputs();
    </script>
</body>
</html>